<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.98.0"><meta name=generator content="Relearn 3.4.1"><meta name=description content><meta name=author content="Choria Project"><title>Discover Command Type :: Choria Application Builder Documentation</title><link href=https://choria-io.github.io/appbuilder/css/nucleus.css?1659257106 rel=stylesheet><link href=https://choria-io.github.io/appbuilder/css/fontawesome-all.min.css?1659257106 rel=stylesheet><link href=https://choria-io.github.io/appbuilder/css/featherlight.min.css?1659257106 rel=stylesheet><link href=https://choria-io.github.io/appbuilder/css/perfect-scrollbar.min.css?1659257106 rel=stylesheet><link href=https://choria-io.github.io/appbuilder/css/auto-complete.css?1659257106 rel=stylesheet><link href=https://choria-io.github.io/appbuilder/css/theme.css?1659257106 rel=stylesheet><link href=https://choria-io.github.io/appbuilder/css/theme-my-custom-variant.css?1659257106 rel=stylesheet id=variant-style><link href=https://choria-io.github.io/appbuilder/css/variant.css?1659257106 rel=stylesheet><link href=https://choria-io.github.io/appbuilder/css/print.css?1659257106 rel=stylesheet media=print><style>:not(pre)>code.copy-to-clipboard-code+span.copy-to-clipboard-button{display:none}:not(pre)>code.copy-to-clipboard-code{border-bottom-right-radius:2px;border-top-right-radius:2px;border-right-width:1px}</style><script src=https://choria-io.github.io/appbuilder/js/variant.js?1659257106></script>
<script>var index_url="https://choria-io.github.io/appbuilder/index.json",baseUriFull,root_url="https://choria-io.github.io/appbuilder/",baseUri=root_url.replace(/\/$/,'');window.T_Copy_to_clipboard="Copy to clipboard",window.T_Copied_to_clipboard="Copied to clipboard!",window.T_Copy_link_to_clipboard="Copy link to clipboard",window.T_Link_copied_to_clipboard="Copied link to clipboard!",baseUriFull="https://choria-io.github.io/appbuilder/",variants.init(["my-custom-variant"])</script><script src=https://choria-io.github.io/appbuilder/js/jquery.min.js?1659257106></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-YW7H6PL0TN"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YW7H6PL0TN",{anonymize_ip:!1})}</script></head><body class=mobile-support data-url=https://choria-io.github.io/appbuilder/reference/discovery/><div id=body class=default-animation><div id=sidebar-overlay></div><div id=toc-overlay></div><nav id=topbar class=highlightable><div><div class=navigation><a class="nav nav-next" href=https://choria-io.github.io/appbuilder/reference/rpc/ title="Choria RPC Command Type"><i class="fas fa-chevron-right fa-fw"></i></a></div><div class=navigation><a class="nav nav-prev" href=https://choria-io.github.io/appbuilder/reference/exec/ title="Exec Command Type"><i class="fas fa-chevron-left fa-fw"></i></a></div><div id=breadcrumbs><span id=sidebar-toggle-span><a href=# id=sidebar-toggle title=Menu><i class="fas fa-bars fa-fw"></i></a></span>
<span id=toc-menu title="Table of Contents"><i class="fas fa-list-alt fa-fw"></i></span><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3"><a itemprop=item href=https://choria-io.github.io/appbuilder/><span itemprop=name>Choria Application Builder Documentation</span></a> ></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="2"><a itemprop=item href=https://choria-io.github.io/appbuilder/reference/><span itemprop=name>Reference</span></a> ></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="1"><a itemprop=item href=https://choria-io.github.io/appbuilder/reference/discovery/ aria-disabled=true><span itemprop=name>Discover Command Type</span></a></li></ol></div><div class="default-animation progress"><div class=wrapper><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#filter-reference>Filter Reference</a></li></ul></nav></div></div></div></nav><main id=body-inner class=highlightable><div class=flex-block-wrapper><div id=head-tags></div><article><h1>Discover Command Type</h1><p>The Discover command interact with the Choria Discovery system used to find fleet nodes based on a vast array of
possible queries and data sources.</p><p>Since this is built into Choria it will simply use your Choria Client configuration for the user executing the command
to find the Choria Brokers and more. It supports the usual override methods such as creating a <code>choria.conf</code> file in
your project working directory. No connection properties are required or supported.</p><p>Before using this command type I suggest reading about the <a href=https://choria.io/docs/concepts/discovery/>Choria Discovery System</a>.</p><div class="box notices secondary"><div class=box-label><i class="fas fa-code-branch fa-fw"></i> Version Hint</div><div class=box-content><p>This feature is only available when hosting App Builder applications within the Choria Server version 0.26.0 or newer</p></div></div><h2 id=overview>Overview</h2><p>This command supports all the standard properties like Arguments, Flags, Banners and more, below is a simply command
that finds apache servers.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>find</span>
</span></span><span style=display:flex><span><span style=color:#f92672>description</span>: <span style=color:#ae81ff>Finds all machines tagged as Apache Servers</span>
</span></span><span style=display:flex><span><span style=color:#f92672>type</span>: <span style=color:#ae81ff>discover</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>std_filters</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span><span style=color:#f92672>filter</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>classes</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>roles::apache</span>
</span></span></code></pre></div><p>When run it will show a list of matching nodes, one per line. It also accepts the <code>--json</code> flag to enable returning a
JSON array of matching nodes.</p><p>Since the <code>std_filters</code> option is set the command will also accept additional filters in standard Choria format. Flags
like <code>-C</code>, <code>-F</code>, discovery mode selectors and more. User supplied options will be merged/appended with the ones supplied
in the YAML file. By default, none of the standard Choria flags will be added to the CLI.</p><p>All the filter values, even arrays and objects, support <a href=../templating/>templating</a>.</p><h2 id=filter-reference>Filter Reference</h2><p>The main tunable here is the filter, below a reference of available options. The examples here are a bit short, I suggest
you read the <a href=https://choria.io/docs/concepts/discovery/>Choria Discovery Documentation</a> for a thorough understanding.</p><table><thead><tr><th>Key</th><th>Description</th><th>Example</th></tr></thead><tbody><tr><td><code>collective</code></td><td>The collective to target, defaults to main collective</td><td><code>collective: development</code></td></tr><tr><td><code>facts</code></td><td>List of fact filters as passed to <code>-F</code></td><td><code>facts: ["country=uk"]</code></td></tr><tr><td><code>agents</code></td><td>List of agent filters as passed to <code>-A</code></td><td><code>agents: ["puppet"]</code></td></tr><tr><td><code>classes</code></td><td>List of Config Management classes to match as passed to <code>-C</code></td><td><code>classes: ["apache"]</code></td></tr><tr><td><code>identities</code></td><td>List of node identities to match as passed to <code>-I</code></td><td><code>identities:["/^web/"]</code></td></tr><tr><td><code>combined</code></td><td>List of Combined filters as passed to <code>-W</code></td><td><code>combined:["/^web/","location=uk"]</code></td></tr><tr><td><code>compound</code></td><td>A single Compound filter as passed to <code>-S</code></td><td><code>compound: "with('apache') or with('nginx')</code></td></tr><tr><td><code>discovery_method</code></td><td>A discovery method to use like <code>inventory</code> as passed to <code>--dm</code></td><td><code>discovery_method:"flatfile"</code></td></tr><tr><td><code>discovery_options</code></td><td>A set of discovery options, specific to the <code>discovery_method</code> chosen</td><td><code>discovery_options: {"file":"/etc/inventory.yaml"}</code></td></tr><tr><td><code>discovery_timeout</code></td><td>How long discovery can run, in seconds, as passed to <code>--discovery-timeout</code></td><td><code>discovery_timeout: 2</code></td></tr><tr><td><code>dynamic_discovery_timeout</code></td><td>Enables windowed dynamic timeout rather than a set discovery timeout</td><td><code>dynamic_discovery_timeout: true</code></td></tr><tr><td><code>nodes_file</code></td><td>Short cut to use flatfile discovery with a specific file, as passed to <code>--nodes</code></td><td><code>nodes_file: /etc/fleet.txt</code></td></tr></tbody></table><footer class=footline></footer></article></div></main></div><aside id=sidebar class=default-animation><div id=header-wrapper class=default-animation><div id=header class=default-animation><img src=https://choria-io.github.io/appbuilder/logo.png></div><div class="searchbox default-animation"><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script src=https://choria-io.github.io/appbuilder/js/lunr.min.js?1659257106></script>
<script src=https://choria-io.github.io/appbuilder/js/auto-complete.js?1659257106></script>
<script src=https://choria-io.github.io/appbuilder/js/search.js?1659257106></script></div><div id=homelinks class=default-animation><ul><li><a class=padding href=https://choria-io.github.io/appbuilder/><i class="fas fa-home"></i> Home</a></li></ul></div><div id=content-wrapper class=highlightable><ul class=topics><li data-nav-id=/quick-start/ title="Quick Start" class=dd-item><a href=https://choria-io.github.io/appbuilder/quick-start/><b>1. </b>Quick Start</a></li><li data-nav-id=/reference/ title=Reference class="dd-item parent alwaysopen"><input type=checkbox id=section-aaf4dc0c3ad418fa5118c9d2a0c2270f class=toggle checked><label for=section-aaf4dc0c3ad418fa5118c9d2a0c2270f></label><a href=https://choria-io.github.io/appbuilder/reference/><b>2. </b>Reference</a><ul><li data-nav-id=/reference/common-settings/ title="Common Settings" class=dd-item><a href=https://choria-io.github.io/appbuilder/reference/common-settings/>Common Settings</a></li><li data-nav-id=/reference/parent/ title="Parent Command Type" class=dd-item><a href=https://choria-io.github.io/appbuilder/reference/parent/>Parent Command Type</a></li><li data-nav-id=/reference/exec/ title="Exec Command Type" class=dd-item><a href=https://choria-io.github.io/appbuilder/reference/exec/>Exec Command Type</a></li><li data-nav-id=/reference/discovery/ title="Discover Command Type" class="dd-item active"><a href=https://choria-io.github.io/appbuilder/reference/discovery/>Discover Command Type</a></li><li data-nav-id=/reference/rpc/ title="Choria RPC Command Type" class=dd-item><a href=https://choria-io.github.io/appbuilder/reference/rpc/>Choria RPC Command Type</a></li><li data-nav-id=/reference/kv/ title="KV Command Type" class=dd-item><a href=https://choria-io.github.io/appbuilder/reference/kv/>KV Command Type</a></li><li data-nav-id=/reference/templating/ title=Templating class=dd-item><a href=https://choria-io.github.io/appbuilder/reference/templating/>Templating</a></li><li data-nav-id=/reference/transformations/ title=Transformations class=dd-item><a href=https://choria-io.github.io/appbuilder/reference/transformations/>Transformations</a></li><li data-nav-id=/reference/configuration/ title=Configuration class=dd-item><a href=https://choria-io.github.io/appbuilder/reference/configuration/>Configuration</a></li><li data-nav-id=/reference/cheats/ title="Cheat Sheets" class=dd-item><a href=https://choria-io.github.io/appbuilder/reference/cheats/>Cheat Sheets</a></li><li data-nav-id=/reference/file-locations/ title="File Locations" class=dd-item><a href=https://choria-io.github.io/appbuilder/reference/file-locations/>File Locations</a></li><li data-nav-id=/reference/running-validation/ title="Runtime Settings and Tools" class=dd-item><a href=https://choria-io.github.io/appbuilder/reference/running-validation/>Runtime Settings and Tools</a></li></ul></li></ul><div id=shortcuts><div class=nav-title>More</div><ul><li><a class=padding href=https://github.com/choria-io/appbuilder><i class="fab fa-fw fa-github"></i> GitHub</a></li><li><a class=padding href=https://github.com/choria-io/appbuilder/releases><i class="far fa-save"></i> Download</a></li><li><a class=padding href=https://github.com/choria-io/appbuilder/discussions><i class="far fa-comments"></i> Discussions</a></li><li><a class=padding href=https://github.com/choria-io/appbuilder/issues><i class="far fa-life-ring"></i> Issues</a></li><li><a class=padding href=https://slack.puppet.com/><i class="fab fa-slack"></i> #choria</a></li></ul></div><div class="footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter"></div><hr class="default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter"><div id=prefooter class="footerLangSwitch footerVariantSwitch footerVisitedLinks"><ul><li id=select-language-container class=footerLangSwitch><a class="padding select-container"><i class="fas fa-language fa-fw"></i>
<span>&nbsp;</span><div class=select-style><select id=select-language onchange="location=baseUri+this.value"></select></div><div class=select-clear></div></a></li><li id=select-variant-container class=footerVariantSwitch><a class="padding select-container"><i class="fas fa-paint-brush fa-fw"></i>
<span>&nbsp;</span><div class=select-style><select id=select-variant onchange=variants.changeVariant(this.value)><option id=my-custom-variant value=my-custom-variant selected>My Custom Variant</option></select></div><div class=select-clear></div></a><script>variants.markSelectedVariant()</script></li><li class=footerVisitedLinks><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></div><div id=footer class="footerFooter showFooter"><p>Built with <a href=https://github.com/McShelby/hugo-theme-relearn><i class="fas fa-heart"></i></a> by <a href=https://gohugo.io/>Hugo</a></p></div></div></aside><script src=https://choria-io.github.io/appbuilder/js/clipboard.min.js?1659257106></script>
<script src=https://choria-io.github.io/appbuilder/js/perfect-scrollbar.min.js?1659257106></script>
<script src=https://choria-io.github.io/appbuilder/js/featherlight.min.js?1659257106></script>
<script src=https://choria-io.github.io/appbuilder/js/theme.js?1659257106></script></body></html>